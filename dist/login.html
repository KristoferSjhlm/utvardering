<!doctype html>
<html>
<head>
    <title>Lektionsmål inlogg</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- own css -->
    <link rel="stylesheet" type="text/css" href="css/style.css">

</head>
<body> 





  <div id="main-content" class="container theme-showcase" role="main">


        <h2 class="form-signin-heading">Please sign in</h2>
        <label for="inputEmail" class="sr-only">Email address</label>
        <input type="email" id="inputEmail" class="form-control" placeholder="Email address" required autofocus>
        <label for="inputPassword" class="sr-only">Password</label>
        <input type="password" id="inputPassword" class="form-control" placeholder="Password" required>
        <!--
        <div class="checkbox">
          <label>
            <input type="checkbox" value="remember-me"> Remember me
          </label>
        </div>
        -->
        <button id="form-submit" class="btn btn-primary">Sign in</button>


<!--
    <h1>Lektionsutvärdering</h1>
  	
  	<form method="get" action="evaluation.html" target="_blank">
           
        <p><span id="klassinput"></span>

        </p>

        <p><div id="malinput"></div>

        </p>

  	    <p><input type="submit" class="btn btn-primary" value="Starta ny lektionsutvärdering"></p>



  	</form>

  	<h2>Grafik över tidigare utvärderingar</h2>

    <form method="get" action="stats.html">
        <p><strong>Välj klass: </strong> <select name="klass" id="selectKlassStats"></select></p>
        <p><input type="submit" class="btn btn-primary" value="Kolla in statistik för klassen"></p>
    </form>

    <a href="#"" id="test">Ladda om sidan/Börja om från början</a>

-->
  </div>

 

	<!-- load libraries in cache that are used on other pages -->


	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="js/bootstrap.min.js"></script>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="js/lib/d3.chart.min.js"></script>
  <script src="js/lib/miso.ds.deps.js"></script>
  <!--<script src="js/stats.js"></script>-->

  <!-- Script that takes out all classnames from the spreadsheet -->

  <script type="text/javascript">
    (function(){
        'use strict';

          var epost = "tomas.sjoholm@soderhamn.se"
          // starttext for selectbox
          //var selectHTML = '<option value="Välj">Välj klass</option>';
          //var selectLessongoalsHTML = '<option value="Välj">Välj lektionsmål</option>';

          //connect to Google Spreadsheet
          var ds = new Miso.Dataset({
              importer : Miso.Dataset.Importers.GoogleSpreadsheet,
              parser : Miso.Dataset.Parsers.GoogleSpreadsheet,
              key : "1q4jt7ZPkjUDwygHr4_y7PogVgVroBdmUR3OSI0TLaWg",
              worksheet : "1"
          });

          // get the data
          ds.fetch({ 
              success : function() {
                  console.log(ds.columnNames(), ds.columnNames().length);
              },
              error : function() {
                  console.log("Something went wrong. Are you sure you are connected to the internet?");
              }
          });

          
          // this function could be used if something need to be done after ds.fetch is done)
          _.when(ds.fetch()).then(function() {


            function checkPassword() {
                var inputEmail = document.getElementById('inputEmail').value;
                var inputPassword = document.getElementById('inputPassword').value;

                var nameDetails = ds.where({
                    // copy over the data for this columns
                    columns: ['Namn', 'Epost', 'Password', 'idSpreadsheet'],
                    // and only where the values are > 1
                    rows: function(row) {
                        return row.Epost == inputEmail
                        //return row.Klass == classes.column('Klass').data[i];
                    }
                    
                });
 
                //if (nameDetails.length ==  1) {

                if (nameDetails.column('Epost').data[0] ==  inputEmail && nameDetails.column('Password').data[0] ==  inputPassword) {

                    alert("Rätt")
                    document.getElementById('main-content').innerHTML = startHTML;
                    startView(nameDetails.column('idSpreadsheet').data[0]);

                } else {

                    alert("Fel användarnamn eller lösenord. Försök igen.")

                }

            }

            // filter the data on the Epost parameter
            
            let startHTML = '<h1>Lektionsutvärdering</h1> \
                \
                <form method="get" action="evaluation.html" target="_blank">\
                    <p><span id="klassinput"></span></p>\
                    <p><div id="malinput"></div></p>\
                    <p><input type="submit" class="btn btn-primary" value="Starta ny lektionsutvärdering"></p>\
                </form>\
                \
                <h2>Grafik över tidigare utvärderingar</h2>\
                \
                <form method="get" action="stats.html">\
                    <p><strong>Välj klass: </strong> <select name="klass" id="selectKlassStats"></select></p>\
                    <p><input type="submit" class="btn btn-primary" value="Kolla in statistik för klassen"></p>\
                </form>\
                \
                <h2><span id="classes"></span></h2>\
                <p id="selectMal"></p>\
                <h1><span id="mal"></span></h1>\
                <div id="bargraph"></div>\
                <h2><span id="mean"></span></h2>'



            //console.log(nameDetails.column('Namn').data[0]);
            //console.log(nameDetails.column('Epost').data[0]);
            //console.log(nameDetails.column('Password').data[0]);
            //console.log(nameDetails.column('idSpreadsheet').data[0]);




            document.getElementById('form-submit').addEventListener ("click", function() { checkPassword();});

            function startView (idSpreadsheet) {

                  // starttext for selectbox
                  var selectHTML = '<option value="Välj">Välj klass</option>';
                  var selectLessongoalsHTML = '<option value="Välj">Välj lektionsmål</option>';

                  //connect to Google Spreadsheet
                  var ds = new Miso.Dataset({
                      importer : Miso.Dataset.Importers.GoogleSpreadsheet,
                      parser : Miso.Dataset.Parsers.GoogleSpreadsheet,
                      key : idSpreadsheet,
                      worksheet : "1"
                  });

                  // get the data
                  ds.fetch({ 
                      success : function() {
                          console.log(ds.columnNames(), ds.columnNames().length);
                      },
                      error : function() {
                          console.log("Something went wrong. Are you sure you are connected to the internet?");
                      }
                  });

                  // this function could be used if something need to be done after ds.fetch is done)
                  _.when(ds.fetch()).then(function() {


                      //Get the different classes and sort by the variabel Klass
                      var classes = ds.countBy('Klass');
                      console.log("Före: " +classes.column('Klass').data);

                      classes.sort(function(rowA, rowB) {
                          if (rowA.Klass > rowB.Klass) {
                              return 1;
                          }
                          if (rowA.Klass < rowB.Klass) {
                              return -1;
                          }
                          return 0;
                      });

                      console.log("Efter: " + classes.column('Klass').data);

                      for (var j = 0; j < classes.length; j++) {

                          selectHTML = selectHTML + '<option value="' + classes.column('Klass').data[j] + '">' + classes.column('Klass').data[j] + '</option>';
                      }


                      document.getElementById('klassinput').innerHTML = "<strong>Ange klass: </strong> <select name='klass' id='klass'></select> <a href='#'' id='nyklass'>Ange en ny klass</a>"
                      document.getElementById('klass').innerHTML = selectHTML;
                      document.getElementById('selectKlassStats').innerHTML = selectHTML;


                      //Get the different lessongoals and sort by the variabel Lektionsmal
                      var lessongoals = ds.countBy('Lektionsmal');
                      console.log("Före: " +lessongoals.column('Lektionsmal').data);

                      lessongoals.sort(function(rowA, rowB) {
                          if (rowA.Lektionsmal > rowB.Lektionsmal) {
                              return 1;
                          }
                          if (rowA.Lektionsmal < rowB.Lektionsmal) {
                              return -1;
                          }
                          return 0;
                      });

                      console.log("Efter: " + lessongoals.column('Lektionsmal').data);

                      for (var j = 0; j < lessongoals.length; j++) {

                          selectLessongoalsHTML = selectLessongoalsHTML + '<option value="' + lessongoals.column('Lektionsmal').data[j] + '">' + lessongoals.column('Lektionsmal').data[j] + '</option>';
                      }

                      document.getElementById('malinput').innerHTML = "<strong>Välj lektionsmål: </strong> <select name='mal' id='mal'></select> <a href='#' id='nyttmal'>Ange ett nytt lektionsmål</a>"
                      document.getElementById('mal').innerHTML = selectLessongoalsHTML;
                      

                      // on click show input form for new class
                      document.getElementById("nyklass").addEventListener("click", function( event ) {
                        document.getElementById("klassinput").innerHTML = "<label>Ange klass <input id='klass' placeholder='Klass, ämne, skola' name='klass'></label>" 
                      }, false);

                      
                      // on click show input form for new lessongoal
                      document.getElementById("nyttmal").addEventListener("click", function( event ) {
                        document.getElementById("malinput").innerHTML = "<label>Mål med lektionen <input id='mal' placeholder='Lektionsmål' name='mal'required></label>" 
                      }, false);

                      var reloadPage = function(){
                        document.location.reload(false);
                      };

                      //document.getElementById("test").addEventListener("click", function( event ) {
                        // display the current click count inside the clicked div
                      //  document.location.reload(false);
                      //}, false);
                  });
              }

          });
          

      })();

    </script>

</body>
</html>